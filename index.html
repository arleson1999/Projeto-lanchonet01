<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LunchControl SaaS - Sistema de Lanchonete</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #FF6B35;
            --primary-hover: #E55A2B;
            --secondary-color: #2C3E50;
            --text-primary: #2C3E50;
            --text-secondary: #7F8C8D;
            --background: #F8F9FA;
            --surface: #FFFFFF;
            --border: #E0E6ED;
            --success: #27AE60;
            --warning: #F39C12;
            --danger: #E74C3C;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition: all 0.2s ease-in-out;
        }

        [data-theme="dark"] {
            --primary-color: #FF8A65;
            --secondary-color: #34495E;
            --text-primary: #ECF0F1;
            --text-secondary: #BDC3C7;
            --background: #1E272E;
            --surface: #2C3E50;
            --border: #34495E;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: var(--surface);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background: none;
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: var(--border);
        }

        .user-menu {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
        }

        .subscription-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .subscription-active {
            color: var(--success);
            border-color: var(--success);
        }

        .subscription-expired {
            color: var(--danger);
            border-color: var(--danger);
        }

        /* Navigation */
        .nav {
            background: var(--secondary-color);
            padding: 0.5rem 0;
        }

        .nav-content {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .nav-link {
            color: var(--text-primary);
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: var(--transition);
            white-space: nowrap;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--primary-color);
            color: white;
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: calc(100vh - 140px);
            gap: 0;
        }

        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 2rem 0;
            overflow-y: auto;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-item {
            margin-bottom: 0.25rem;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .sidebar-link:hover,
        .sidebar-link.active {
            background: var(--background);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .sidebar-link i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 2rem 0;
            overflow-y: auto;
        }

        /* Page Content */
        .page {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--text-secondary);
            color: var(--text-primary);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #C0392B;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #219A52;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            background: var(--surface);
            color: var(--text-primary);
            font-family: inherit;
            transition: var(--transition);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .table th {
            background: var(--secondary-color);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        .table tbody tr:hover {
            background: var(--background);
        }

        .table-responsive {
            overflow-x: auto;
            border-radius: var(--border-radius);
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        /* Charts */
        .chart-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            height: 300px;
            position: relative;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        /* Product Cards */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .product-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            font-weight: bold;
        }

        .product-info {
            padding: 1.25rem;
        }

        .product-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .product-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        .product-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Order Form */
        .order-items {
            margin-bottom: 1.5rem;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
        }

        .order-item select,
        .order-item input {
            flex: 1;
            max-width: 150px;
        }

        .order-total {
            background: var(--secondary-color);
            color: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            text-align: right;
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border-radius: var(--border-radius);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            position: relative;
            width: 100%;
            max-width: 600px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.25rem;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transform: translateX(400px);
            transition: var(--transition);
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success);
            color: white;
        }

        .notification.error {
            background: var(--danger);
            color: white;
        }

        .notification.warning {
            background: var(--warning);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .nav-content {
                justify-content: flex-start;
                padding: 0 1rem;
            }

            .page-header {
                flex-direction: column;
                align-items: stretch;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .order-item {
                flex-direction: column;
                align-items: stretch;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 15px;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .card {
                padding: 1rem;
            }

            .table {
                font-size: 0.875rem;
            }

            .table th,
            .table td {
                padding: 0.75rem 0.5rem;
            }
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Badges */
        .status {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-preparing {
            background: #FFF3CD;
            color: var(--warning);
        }

        .status-delivered {
            background: #D1ECF1;
            color: var(--success);
        }

        .status-cancelled {
            background: #F8D7DA;
            color: var(--danger);
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* SaaS Company Selector */
        .company-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: var(--background);
            border-radius: var(--border-radius);
            border: 1px solid var(--border);
        }

        .company-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .company-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .company-info p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo" onclick="selectPage('dashboard')">
                    <div class="logo-icon">🍔</div>
                    <span>LunchControl SaaS</span>
                </a>
                
                <div class="header-actions">
                    <div class="subscription-status subscription-active">
                        <span>✅</span>
                        <span>Plano Ativo - R$ 199/mês</span>
                    </div>
                    
                    <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">
                        <span id="theme-icon">🌙</span>
                    </button>
                    
                    <div class="user-menu" onclick="toggleUserMenu()">
                        <div class="user-avatar" id="user-avatar">JD</div>
                        <span id="user-name">João Silva</span>
                        <i>▼</i>
                    </div>
                </div>
            </div>
        </div>
        
        <nav class="nav">
            <div class="container">
                <div class="nav-content" id="nav-content">
                    <!-- Navigation will be populated by JavaScript -->
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link active" onclick="selectPage('dashboard'); return false;">
                        <i>📊</i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="selectPage('products'); return false;">
                        <i>🍔</i>
                        <span>Produtos</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="selectPage('orders'); return false;">
                        <i>📋</i>
                        <span>Pedidos</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="selectPage('reports'); return false;">
                        <i>📈</i>
                        <span>Relatórios</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="selectPage('users'); return false;">
                        <i>👥</i>
                        <span>Usuários</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="selectPage('settings'); return false;">
                        <i>⚙️</i>
                        <span>Configurações</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="logout(); return false;">
                        <i>🚪</i>
                        <span>Sair</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Company Selector -->
            <div class="company-selector">
                <div class="company-logo">AB</div>
                <div class="company-info">
                    <h3 id="company-name">Lanchonete A+Burgers</h3>
                    <p id="company-location">Rua das Flores, 123 - Centro</p>
                </div>
                <button class="btn btn-secondary btn-small" onclick="showCompanyModal()">
                    <i>⚙️</i>
                    Alterar Empresa
                </button>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <div class="page-actions">
                        <button class="btn btn-primary" onclick="refreshDashboard()">
                            <i>🔄</i>
                            Atualizar
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-sales">R$ 12.450</div>
                        <div class="stat-label">Vendas Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-orders">89</div>
                        <div class="stat-label">Pedidos Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-prep-time">12min</div>
                        <div class="stat-label">Tempo Médio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="active-orders">5</div>
                        <div class="stat-label">Em Preparo</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Vendas do Mês</h2>
                        <div class="btn-group">
                            <button class="btn btn-secondary btn-small" onclick="changeChartPeriod('week')">Semana</button>
                            <button class="btn btn-secondary btn-small" onclick="changeChartPeriod('month')">Mês</button>
                            <button class="btn btn-secondary btn-small" onclick="changeChartPeriod('year')">Ano</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="sales-chart" class="chart-canvas"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Produtos Mais Vendidos</h2>
                    </div>
                    <div class="products-grid" id="top-products">
                        <!-- Top products will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Products Page -->
            <div id="products" class="page">
                <div class="page-header">
                    <h1 class="page-title">Gerenciar Produtos</h1>
                    <div class="page-actions">
                        <button class="btn btn-primary" onclick="showProductModal('create')">
                            <i>+</i>
                            Novo Produto
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="table-responsive">
                        <table class="table" id="products-table">
                            <thead>
                                <tr>
                                    <th>Imagem</th>
                                    <th>Nome</th>
                                    <th>Categoria</th>
                                    <th>Preço</th>
                                    <th>Estoque</th>
                                    <th>Vendas</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Products will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders Page -->
            <div id="orders" class="page">
                <div class="page-header">
                    <h1 class="page-title">Gerenciar Pedidos</h1>
                    <div class="page-actions">
                        <button class="btn btn-primary" onclick="showOrderModal('create')">
                            <i>+</i>
                            Novo Pedido
                        </button>
                        <button class="btn btn-secondary" onclick="showOrderModal('quick')">
                            <i>⚡</i>
                            Pedido Rápido
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="table-responsive">
                        <table class="table" id="orders-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cliente</th>
                                    <th>Itens</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Orders will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports" class="page">
                <div class="page-header">
                    <h1 class="page-title">Relatórios</h1>
                    <div class="page-actions">
                        <button class="btn btn-primary" onclick="exportReport('csv')">
                            <i>📊</i>
                            Exportar CSV
                        </button>
                        <button class="btn btn-secondary" onclick="printReport()">
                            <i>🖨️</i>
                            Imprimir
                        </button>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Período</label>
                        <select id="report-period" class="form-select" onchange="filterReports()">
                            <option value="today">Hoje</option>
                            <option value="week" selected>Semana</option>
                            <option value="month">Mês</option>
                            <option value="year">Ano</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Relatório</label>
                        <select id="report-type" class="form-select" onchange="filterReports()">
                            <option value="sales">Vendas</option>
                            <option value="products" selected>Produtos</option>
                            <option value="orders">Pedidos</option>
                            <option value="customers">Clientes</option>
                        </select>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="reports-chart" class="chart-canvas"></canvas>
                </div>

                <div class="card">
                    <h3 class="card-title" id="report-title">Relatório de Vendas - Semana</h3>
                    <div id="report-content">
                        <!-- Report content will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users" class="page">
                <div class="page-header">
                    <h1 class="page-title">Gerenciar Usuários</h1>
                    <div class="page-actions">
                        <button class="btn btn-primary" onclick="showUserModal('create')">
                            <i>+</i>
                            Novo Usuário
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="table-responsive">
                        <table class="table" id="users-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>Cargo</th>
                                    <th>Permissões</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Users will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h1 class="page-title">Configurações</h1>
                </div>

                <div class="card">
                    <h2 class="card-title">Configurações da Empresa</h2>
                    <div class="form-group">
                        <label class="form-label">Nome da Empresa</label>
                        <input type="text" class="form-input" id="company-name-input" value="Lanchonete A+Burgers">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">CNPJ</label>
                            <input type="text" class="form-input" id="company-cnpj" value="12.345.678/0001-90">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="text" class="form-input" id="company-phone" value="(11) 99999-9999">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Endereço</label>
                        <input type="text" class="form-input" id="company-address" value="Rua das Flores, 123 - Centro">
                    </div>
                    <button class="btn btn-primary" onclick="saveCompanySettings()">Salvar Configurações</button>
                </div>

                <div class="card">
                    <h2 class="card-title">Configurações do Sistema</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Tempo Médio de Preparo (minutos)</label>
                            <input type="number" class="form-input" id="prep-time" value="15" min="1" max="60">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Taxa de Entrega (R$)</label>
                            <input type="number" step="0.01" class="form-input" id="delivery-fee" value="5.00" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status do Pedido Automático</label>
                        <select class="form-select" id="auto-status">
                            <option value="manual">Manual</option>
                            <option value="auto">Automático (após X minutos)</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="saveSystemSettings()">Salvar Configurações</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="login-modal" class="modal active">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Acesso ao Sistema</h2>
                <button class="modal-close" onclick="closeModal('login-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="login-form" onsubmit="login(event)">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="login-email" required placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" class="form-input" id="login-password" required placeholder="••••••••">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Empresa</label>
                        <select class="form-select" id="login-company" required>
                            <option value="">Selecione uma empresa</option>
                            <option value="lanchonete-a">Lanchonete A+Burgers</option>
                            <option value="burger-king">Burger King</option>
                            <option value="mcdonalds">McDonald's</option>
                            <option value="subway">Subway</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-full">Entrar no Sistema</button>
                </form>
                <div style="margin-top: 1rem; text-align: center;">
                    <small>Demo: admin@demo.com / senha123</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="product-modal-title">Novo Produto</h2>
                <button class="modal-close" onclick="closeModal('product-modal')">&times;</button>
            </div>
            <form id="product-form" onsubmit="saveProduct(event)">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nome do Produto</label>
                            <input type="text" class="form-input" id="product-name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-select" id="product-category" required>
                                <option value="lanche">Lanche</option>
                                <option value="bebida">Bebida</option>
                                <option value="acompanhamento">Acompanhamento</option>
                                <option value="sobremesa">Sobremesa</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Preço (R$)</label>
                            <input type="number" step="0.01" class="form-input" id="product-price" required min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Estoque</label>
                            <input type="number" class="form-input" id="product-stock" required min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <textarea class="form-textarea" id="product-description" rows="3" placeholder="Descreva o produto..."></textarea>
                    </div>
                    <input type="hidden" id="product-id">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('product-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Produto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Order Modal -->
    <div id="order-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title" id="order-modal-title">Novo Pedido</h2>
                <button class="modal-close" onclick="closeModal('order-modal')">&times;</button>
            </div>
            <form id="order-form" onsubmit="saveOrder(event)">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nome do Cliente</label>
                            <input type="text" class="form-input" id="order-customer" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" class="form-input" id="order-phone">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Itens do Pedido</label>
                        <div class="order-items" id="order-items">
                            <div class="order-item">
                                <select class="form-select" onchange="updateOrderTotal()">
                                    <option value="">Selecione um produto</option>
                                </select>
                                <input type="number" class="form-input" min="1" value="1" onchange="updateOrderTotal()" style="width: 80px;">
                                <button type="button" class="btn btn-danger btn-small" onclick="removeOrderItem(this)">Remover</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-small" onclick="addOrderItem()">+ Adicionar Item</button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Observações</label>
                        <textarea class="form-textarea" id="order-notes" rows="2" placeholder="Observações especiais..."></textarea>
                    </div>

                    <div class="order-total" id="order-total">
                        Total: R$ 0,00
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('order-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Confirmar Pedido</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Modal -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="user-modal-title">Novo Usuário</h2>
                <button class="modal-close" onclick="closeModal('user-modal')">&times;</button>
            </div>
            <form id="user-form" onsubmit="saveUser(event)">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nome Completo</label>
                            <input type="text" class="form-input" id="user-name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="user-email" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Senha</label>
                            <input type="password" class="form-input" id="user-password" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirmar Senha</label>
                            <input type="password" class="form-input" id="user-password-confirm" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Cargo</label>
                            <select class="form-select" id="user-role" required>
                                <option value="atendente">Atendente</option>
                                <option value="gerente">Gerente</option>
                                <option value="administrador">Administrador</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="user-status" required>
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                    </div>
                    <input type="hidden" id="user-id">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('user-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Usuário</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Company Modal -->
    <div id="company-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Selecionar Empresa</h2>
                <button class="modal-close" onclick="closeModal('company-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Empresas Disponíveis</label>
                    <select class="form-select" id="company-selector" onchange="previewCompany()">
                        <option value="lanchonete-a">Lanchonete A+Burgers</option>
                        <option value="burger-king">Burger King</option>
                        <option value="mcdonalds">McDonald's</option>
                        <option value="subway">Subway</option>
                    </select>
                </div>
                <div id="company-preview" style="margin-top: 1rem; padding: 1rem; background: var(--background); border-radius: var(--border-radius); display: none;">
                    <h4>Pré-visualização:</h4>
                    <div id="company-preview-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('company-modal')">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="switchCompany()">Alternar Empresa</button>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notification-container"></div>

    <script>
        // Global State Management
        class LunchControlApp {
            constructor() {
                this.currentUser = null;
                this.currentCompany = 'lanchonete-a';
                this.companies = {
                    'lanchonete-a': { name: 'Lanchonete A+Burgers', location: 'Rua das Flores, 123 - Centro', logo: 'AB', color: '#FF6B35' },
                    'burger-king': { name: 'Burger King', location: 'Av. Paulista, 1000 - Bela Vista', logo: 'BK', color: '#FDB827' },
                    'mcdonalds': { name: "McDonald's", location: 'Rua Augusta, 1500 - Consolação', logo: 'M', color: '#FFCC00' },
                    'subway': { name: 'Subway', location: 'Av. Brigadeiro Faria Lima, 3400 - Itaim', logo: 'S', color: '#00A651' }
                };
                this.products = [];
                this.orders = [];
                this.users = [];
                this.settings = {
                    prepTime: 15,
                    deliveryFee: 5.00,
                    autoStatus: 'manual'
                };
                this.theme = localStorage.getItem('theme') || 'light';
                this.init();
            }

            init() {
                this.loadData();
                this.setupEventListeners();
                this.applyTheme();
                this.populateNavigation();
                this.updateCompanyInfo();
                this.renderDashboard();
                this.renderProducts();
                this.renderOrders();
                this.renderUsers();
                this.renderReports();
                
                // Demo data
                if (this.products.length === 0) {
                    this.generateDemoData();
                }
                
                // Check authentication
                if (!this.currentUser) {
                    this.showModal('login-modal');
                }
            }

            setupEventListeners() {
                // Form validations
                document.getElementById('login-form').addEventListener('submit', (e) => this.login(e));
                document.getElementById('product-form').addEventListener('submit', (e) => this.saveProduct(e));
                document.getElementById('order-form').addEventListener('submit', (e) => this.saveOrder(e));
                document.getElementById('user-form').addEventListener('submit', (e) => this.saveUser(e));
                
                // Real-time updates
                document.addEventListener('input', (e) => {
                    if (e.target.closest('#order-items')) {
                        this.updateOrderTotal();
                    }
                });

                // Company settings
                document.getElementById('company-name-input').addEventListener('input', (e) => {
                    this.companies[this.currentCompany].name = e.target.value;
                    this.updateCompanyInfo();
                });
            }

            // Authentication
            login(event) {
                event.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const company = document.getElementById('login-company').value;

                // Demo authentication
                if (email === 'admin@demo.com' && password === 'senha123' && company) {
                    this.currentUser = {
                        id: 1,
                        name: 'João Silva',
                        email: email,
                        role: 'administrador',
                        avatar: 'JS'
                    };
                    this.currentCompany = company;
                    this.saveData();
                    this.updateUIAfterLogin();
                    this.showNotification('Login realizado com sucesso!', 'success');
                    this.closeModal('login-modal');
                } else {
                    this.showNotification('Credenciais inválidas!', 'error');
                }
            }

            logout() {
                this.currentUser = null;
                localStorage.removeItem('lunchcontrol-user');
                this.showModal('login-modal');
                this.showNotification('Logout realizado com sucesso!', 'success');
            }

            updateUIAfterLogin() {
                document.getElementById('user-avatar').textContent = this.currentUser.avatar;
                document.getElementById('user-name').textContent = this.currentUser.name;
                document.querySelectorAll('.page').forEach(page => page.style.display = 'block');
                this.updateCompanyInfo();
                this.populateProductSelects();
            }

            // Company Management (SaaS)
            updateCompanyInfo() {
                const company = this.companies[this.currentCompany];
                document.getElementById('company-name').textContent = company.name;
                document.getElementById('company-location').textContent = company.location;
                
                // Update theme color for current company
                document.documentElement.style.setProperty('--primary-color', company.color);
                
                // Update logo in header
                const logoIcon = document.querySelector('.logo-icon');
                logoIcon.textContent = company.logo;
                logoIcon.style.background = company.color;
            }

            switchCompany() {
                const companyId = document.getElementById('company-selector').value;
                if (companyId && companyId !== this.currentCompany) {
                    this.currentCompany = companyId;
                    this.saveData();
                    this.updateCompanyInfo();
                    this.showNotification(`Empresa alterada para: ${this.companies[companyId].name}`, 'success');
                    this.closeModal('company-modal');
                    this.refreshDashboard();
                }
            }

            showCompanyModal() {
                document.getElementById('company-selector').value = this.currentCompany;
                this.previewCompany();
                this.showModal('company-modal');
            }

            previewCompany() {
                const companyId = document.getElementById('company-selector').value;
                const preview = document.getElementById('company-preview');
                if (companyId) {
                    const company = this.companies[companyId];
                    document.getElementById('company-preview-content').innerHTML = `
                        <p><strong>Nome:</strong> ${company.name}</p>
                        <p><strong>Localização:</strong> ${company.location}</p>
                        <p><strong>Cor Principal:</strong> <span style="background: ${company.color}; width: 20px; height: 20px; display: inline-block; border-radius: 50%;"></span> ${company.color}</p>
                    `;
                    preview.style.display = 'block';
                } else {
                    preview.style.display = 'none';
                }
            }

            // Products Management
            generateDemoData() {
                this.products = [
                    { id: 1, name: 'Cheeseburger Clássico', category: 'lanche', price: 18.90, stock: 50, sales: 120, description: 'Hambúrguer de carne bovina com queijo cheddar, alface, tomate e molho especial.' },
                    { id: 2, name: 'Coca-Cola 350ml', category: 'bebida', price: 5.00, stock: 200, sales: 300, description: 'Refrigerante Coca-Cola em lata de 350ml.' },
                    { id: 3, name: 'Batata Frita Grande', category: 'acompanhamento', price: 12.00, stock: 80, sales: 95, description: 'Batata frita crocante com sal fino.' },
                    { id: 4, name: 'X-Salada', category: 'lanche', price: 22.50, stock: 30, sales: 85, description: 'Hambúrguer com carne, queijo, presunto, alface, tomate e milho.' },
                    { id: 5, name: 'Suco de Laranja Natural', category: 'bebida', price: 8.50, stock: 40, sales: 60, description: 'Suco natural de laranja fresca.' },
                    { id: 6, name: 'Sobremesa Cheesecake', category: 'sobremesa', price: 15.90, stock: 25, sales: 45, description: 'Delicioso cheesecake com calda de morango.' }
                ];

                this.orders = [
                    { id: 1, customer: 'Maria Silva', items: [{productId: 1, quantity: 2}, {productId: 2, quantity: 1}], total: 42.80, status: 'preparando', date: '2024-01-15 14:30', notes: 'Sem cebola' },
                    { id: 2, customer: 'Pedro Santos', items: [{productId: 4, quantity: 1}, {productId: 3, quantity: 1}], total: 34.50, status: 'entregue', date: '2024-01-15 15:10', notes: '' },
                    { id: 3, customer: 'Ana Costa', items: [{productId: 1, quantity: 1}, {productId: 5, quantity: 1}], total: 27.40, status: 'preparando', date: '2024-01-15 15:45', notes: 'Rápido por favor' },
                    { id: 4, customer: 'Lucas Oliveira', items: [{productId: 6, quantity: 1}], total: 15.90, status: 'cancelado', date: '2024-01-15 16:00', notes: 'Cliente não compareceu' },
                    { id: 5, customer: 'Fernanda Lima', items: [{productId: 2, quantity: 2}, {productId: 3, quantity: 1}], total: 22.00, status: 'entregue', date: '2024-01-15 16:30', notes: '' }
                ];

                this.users = [
                    { id: 1, name: 'João Silva', email: 'admin@demo.com', role: 'administrador', status: 'ativo', permissions: ['all'] },
                    { id: 2, name: 'Maria Santos', email: 'gerente@lanchonete.com', role: 'gerente', status: 'ativo', permissions: ['products', 'orders', 'reports'] },
                    { id: 3, name: 'Carlos Souza', email: 'atendente@lanchonete.com', role: 'atendente', status: 'ativo', permissions: ['orders'] },
                    { id: 4, name: 'Ana Oliveira', email: 'atendente2@lanchonete.com', role: 'atendente', status: 'inativo', permissions: ['orders'] }
                ];

                this.saveData();
                this.renderAll();
            }

            saveProduct(event) {
                event.preventDefault();
                const id = document.getElementById('product-id').value;
                const product = {
                    id: id ? parseInt(id) : Date.now(),
                    name: document.getElementById('product-name').value,
                    category: document.getElementById('product-category').value,
                    price: parseFloat(document.getElementById('product-price').value),
                    stock: parseInt(document.getElementById('product-stock').value),
                    description: document.getElementById('product-description').value,
                    sales: id ? this.products.find(p => p.id == id).sales : 0
                };

                if (id) {
                    const index = this.products.findIndex(p => p.id == id);
                    this.products[index] = product;
                    this.showNotification('Produto atualizado com sucesso!', 'success');
                } else {
                    this.products.push(product);
                    this.showNotification('Produto criado com sucesso!', 'success');
                }

                this.saveData();
                this.renderProducts();
                this.populateProductSelects();
                this.closeModal('product-modal');
                this.renderTopProducts();
            }

            showProductModal(mode = 'create', productId = null) {
                document.getElementById('product-modal-title').textContent = mode === 'create' ? 'Novo Produto' : 'Editar Produto';
                document.getElementById('product-form').reset();

                if (mode === 'edit' && productId) {
                    const product = this.products.find(p => p.id == productId);
                    if (product) {
                        document.getElementById('product-id').value = product.id;
                        document.getElementById('product-name').value = product.name;
                        document.getElementById('product-category').value = product.category;
                        document.getElementById('product-price').value = product.price;
                        document.getElementById('product-stock').value = product.stock;
                        document.getElementById('product-description').value = product.description;
                    }
                }

                this.showModal('product-modal');
            }

            deleteProduct(productId) {
                if (confirm('Tem certeza que deseja excluir este produto?')) {
                    this.products = this.products.filter(p => p.id != productId);
                    this.saveData();
                    this.renderProducts();
                    this.showNotification('Produto excluído com sucesso!', 'success');
                    this.populateProductSelects();
                }
            }

            renderProducts() {
                const tbody = document.querySelector('#products-table tbody');
                tbody.innerHTML = '';

                if (this.products.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><div class="empty-state-icon">🍔</div><p>Nenhum produto cadastrado.</p></td></tr>';
                    return;
                }

                this.products.forEach(product => {
                    const categoryIcon = {
                        'lanche': '🍔',
                        'bebida': '🥤',
                        'acompanhamento': '🍟',
                        'sobremesa': '🍰'
                    }[product.category] || '📦';

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${categoryIcon}</td>
                        <td>${product.name}</td>
                        <td>${product.category.charAt(0).toUpperCase() + product.category.slice(1)}</td>
                        <td>R$ ${product.price.toFixed(2)}</td>
                        <td>${product.stock}</td>
                        <td>${product.sales}</td>
                        <td>
                            <button class="btn btn-secondary btn-small" onclick="app.showProductModal('edit', ${product.id})" title="Editar">
                                <i>✏️</i>
                            </button>
                            <button class="btn btn-danger btn-small" onclick="app.deleteProduct(${product.id})" title="Excluir">
                                <i>🗑️</i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Orders Management
            saveOrder(event) {
                event.preventDefault();
                const orderItems = document.querySelectorAll('#order-items .order-item');
                const items = Array.from(orderItems).map(item => {
                    const select = item.querySelector('select');
                    const quantityInput = item.querySelector('input[type="number"]');
                    return {
                        productId: parseInt(select.value),
                        quantity: parseInt(quantityInput.value)
                    };
                }).filter(item => item.productId);

                if (items.length === 0) {
                    this.showNotification('Adicione pelo menos um item ao pedido!', 'warning');
                    return;
                }

                const order = {
                    id: document.getElementById('order-id') ? parseInt(document.getElementById('order-id').value) : Date.now(),
                    customer: document.getElementById('order-customer').value,
                    phone: document.getElementById('order-phone').value,
                    items: items,
                    total: parseFloat(document.getElementById('order-total-value').textContent.replace('R$ ', '').replace(',', '.')),
                    status: 'preparando',
                    date: new Date().toISOString(),
                    notes: document.getElementById('order-notes').value
                };

                if (document.getElementById('order-id')) {
                    const index = this.orders.findIndex(o => o.id == order.id);
                    this.orders[index] = order;
                    this.showNotification('Pedido atualizado com sucesso!', 'success');
                } else {
                    this.orders.unshift(order);
                    this.showNotification('Pedido criado com sucesso!', 'success');
                    // Simulate notification sound
                    this.playNotificationSound();
                }

                this.saveData();
                this.renderOrders();
                this.closeModal('order-modal');
                this.refreshDashboard();
            }

            showOrderModal(mode = 'create', orderId = null) {
                document.getElementById('order-modal-title').textContent = mode === 'create' ? 'Novo Pedido' : 'Editar Pedido';
                document.getElementById('order-form').reset();
                document.getElementById('order-items').innerHTML = `
                    <div class="order-item">
                        <select class="form-select" onchange="app.updateOrderTotal()">
                            <option value="">Selecione um produto</option>
                        </select>
                        <input type="number" class="form-input" min="1" value="1" onchange="app.updateOrderTotal()" style="width: 80px;">
                        <button type="button" class="btn btn-danger btn-small" onclick="app.removeOrderItem(this)">Remover</button>
                    </div>
                `;

                if (mode === 'edit' && orderId) {
                    const order = this.orders.find(o => o.id == orderId);
                    if (order) {
                        document.getElementById('order-id').value = order.id;
                        document.getElementById('order-customer').value = order.customer;
                        document.getElementById('order-phone').value = order.phone;
                        document.getElementById('order-notes').value = order.notes;
                        
                        // Populate items
                        const itemsContainer = document.getElementById('order-items');
                        itemsContainer.innerHTML = '';
                        order.items.forEach((item, index) => {
                            const product = this.products.find(p => p.id === item.productId);
                            if (product) {
                                const itemDiv = document.createElement('div');
                                itemDiv.className = 'order-item';
                                itemDiv.innerHTML = `
                                    <select class="form-select" onchange="app.updateOrderTotal()" value="${product.id}">
                                        <option value="">Selecione um produto</option>
                                        ${this.products.map(p => `<option value="${p.id}" ${p.id === product.id ? 'selected' : ''}>${p.name} - R$ ${p.price.toFixed(2)}</option>`).join('')}
                                    </select>
                                    <input type="number" class="form-input" min="1" value="${item.quantity}" onchange="app.updateOrderTotal()" style="width: 80px;">
                                    <button type="button" class="btn btn-danger btn-small" onclick="app.removeOrderItem(this)">Remover</button>
                                `;
                                itemsContainer.appendChild(itemDiv);
                            }
                        });
                        
                        this.updateOrderTotal();
                    }
                } else if (mode === 'quick') {
                    document.getElementById('order-customer').value = 'Cliente Rápido';
                    document.getElementById('order-phone').value = '(11) 99999-9999';
                }

                this.populateProductSelects();
                this.showModal('order-modal');
            }

            addOrderItem() {
                const itemsContainer = document.getElementById('order-items');
                const newItem = document.createElement('div');
                newItem.className = 'order-item';
                newItem.innerHTML = `
                    <select class="form-select" onchange="app.updateOrderTotal()">
                        <option value="">Selecione um produto</option>
                        ${this.products.map(product => 
                            `<option value="${product.id}">${product.name} - R$ ${product.price.toFixed(2)}</option>`
                        ).join('')}
                    </select>
                    <input type="number" class="form-input" min="1" value="1" onchange="app.updateOrderTotal()" style="width: 80px;">
                    <button type="button" class="btn btn-danger btn-small" onclick="app.removeOrderItem(this)">Remover</button>
                `;
                itemsContainer.appendChild(newItem);
                this.updateOrderTotal();
            }

            removeOrderItem(button) {
                button.closest('.order-item').remove();
                this.updateOrderTotal();
            }

            updateOrderTotal() {
                let total = 0;
                const orderItems = document.querySelectorAll('#order-items .order-item');
                
                orderItems.forEach(item => {
                    const select = item.querySelector('select');
                    const quantityInput = item.querySelector('input[type="number"]');
                    const productId = parseInt(select.value);
                    const quantity = parseInt(quantityInput.value) || 0;
                    
                    if (productId && quantity > 0) {
                        const product = this.products.find(p => p.id === productId);
                        if (product) {
                            total += product.price * quantity;
                        }
                    }
                });

                document.getElementById('order-total').innerHTML = `Total: R$ ${total.toFixed(2).replace('.', ',')}`;
                document.getElementById('order-total-value') ? 
                    document.getElementById('order-total-value').textContent = total.toFixed(2) : 
                    null;
            }

            updateOrderStatus(orderId, status) {
                const order = this.orders.find(o => o.id == orderId);
                if (order) {
                    order.status = status;
                    order.updatedAt = new Date().toISOString();
                    
                    if (status === 'entregue') {
                        order.items.forEach(item => {
                            const product = this.products.find(p => p.id === item.productId);
                            if (product) {
                                product.stock -= item.quantity;
                                product.sales += item.quantity;
                            }
                        });
                    }
                    
                    this.saveData();
                    this.renderOrders();
                    this.refreshDashboard();
                    this.showNotification(`Status do pedido ${orderId} atualizado para: ${status}`, 'success');
                }
            }

            deleteOrder(orderId) {
                if (confirm('Tem certeza que deseja excluir este pedido?')) {
                    this.orders = this.orders.filter(o => o.id != orderId);
                    this.saveData();
                    this.renderOrders();
                    this.showNotification('Pedido excluído com sucesso!', 'success');
                    this.refreshDashboard();
                }
            }

            renderOrders() {
                const tbody = document.querySelector('#orders-table tbody');
                tbody.innerHTML = '';

                if (this.orders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><div class="empty-state-icon">📋</div><p>Nenhum pedido registrado.</p></td></tr>';
                    return;
                }

                this.orders.forEach(order => {
                    const statusClass = {
                        'preparando': 'status-preparing',
                        'entregue': 'status-delivered',
                        'cancelado': 'status-cancelled'
                    }[order.status];

                    const statusText = {
                        'preparando': 'Em Preparo',
                        'entregue': 'Entregue',
                        'cancelado': 'Cancelado'
                    }[order.status];

                    const itemCount = order.items.reduce((sum, item) => sum + item.quantity, 0);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>#${order.id}</td>
                        <td>${order.customer}</td>
                        <td>${itemCount} item(s)</td>
                        <td>R$ ${order.total.toFixed(2)}</td>
                        <td><span class="status ${statusClass}">${statusText}</span></td>
                        <td>${new Date(order.date).toLocaleString('pt-BR')}</td>
                        <td>
                            ${order.status !== 'entregue' ? `
                            <button class="btn btn-success btn-small" onclick="app.updateOrderStatus(${order.id}, 'entregue')" title="Marcar como Entregue">
                                <i>✅</i>
                            </button>
                            ` : ''}
                            <button class="btn btn-secondary btn-small" onclick="app.showOrderModal('edit', ${order.id})" title="Editar">
                                <i>✏️</i>
                            </button>
                            <button class="btn btn-danger btn-small" onclick="app.deleteOrder(${order.id})" title="Excluir">
                                <i>🗑️</i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Users Management
            saveUser(event) {
                event.preventDefault();
                const password = document.getElementById('user-password').value;
                const confirmPassword = document.getElementById('user-password-confirm').value;
                
                if (password !== confirmPassword) {
                    this.showNotification('As senhas não coincidem!', 'error');
                    return;
                }

                const id = document.getElementById('user-id').value;
                const user = {
                    id: id ? parseInt(id) : Date.now(),
                    name: document.getElementById('user-name').value,
                    email: document.getElementById('user-email').value,
                    password: password, // In production, hash this
                    role: document.getElementById('user-role').value,
                    status: document.getElementById('user-status').value,
                    permissions: this.getUserPermissions(document.getElementById('user-role').value)
                };

                if (id) {
                    const index = this.users.findIndex(u => u.id == id);
                    this.users[index] = user;
                    this.showNotification('Usuário atualizado com sucesso!', 'success');
                } else {
                    this.users.push(user);
                    this.showNotification('Usuário criado com sucesso!', 'success');
                }

                this.saveData();
                this.renderUsers();
                this.closeModal('user-modal');
            }

            getUserPermissions(role) {
                const permissions = {
                    'atendente': ['orders'],
                    'gerente': ['products', 'orders', 'reports'],
                    'administrador': ['all']
                };
                return permissions[role] || [];
            }

            showUserModal(mode = 'create', userId = null) {
                document.getElementById('user-modal-title').textContent = mode === 'create' ? 'Novo Usuário' : 'Editar Usuário';
                document.getElementById('user-form').reset();

                if (mode === 'edit' && userId) {
                    const user = this.users.find(u => u.id == userId);
                    if (user) {
                        document.getElementById('user-id').value = user.id;
                        document.getElementById('user-name').value = user.name;
                        document.getElementById('user-email').value = user.email;
                        document.getElementById('user-role').value = user.role;
                        document.getElementById('user-status').value = user.status;
                        // Don't prefill password fields for security
                    }
                }

                this.showModal('user-modal');
            }

            deleteUser(userId) {
                if (confirm('Tem certeza que deseja excluir este usuário?')) {
                    this.users = this.users.filter(u => u.id != userId);
                    this.saveData();
                    this.renderUsers();
                    this.showNotification('Usuário excluído com sucesso!', 'success');
                }
            }

            renderUsers() {
                const tbody = document.querySelector('#users-table tbody');
                tbody.innerHTML = '';

                if (this.users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><div class="empty-state-icon">👥</div><p>Nenhum usuário cadastrado.</p></td></tr>';
                    return;
                }

                this.users.forEach(user => {
                    const statusText = user.status === 'ativo' ? 'Ativo' : 'Inativo';
                    const statusClass = user.status === 'ativo' ? 'status-delivered' : 'status-cancelled';
                    const roleIcon = {
                        'atendente': '👨‍💼',
                        'gerente': '👨‍💼',
                        'administrador': '👑'
                    }[user.role] || '👤';

                    const permissionsText = user.permissions.join(', ') || 'Nenhuma';
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${roleIcon} ${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</td>
                        <td>${permissionsText}</td>
                        <td><span class="status ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-secondary btn-small" onclick="app.showUserModal('edit', ${user.id})" title="Editar">
                                <i>✏️</i>
                            </button>
                            <button class="btn btn-danger btn-small" onclick="app.deleteUser(${user.id})" title="Excluir">
                                <i>🗑️</i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Dashboard & Reports
            refreshDashboard() {
                this.renderDashboard();
                this.showNotification('Dashboard atualizado!', 'success');
            }

            renderDashboard() {
                // Update stats
                const today = new Date();
                const todayOrders = this.orders.filter(order => {
                    const orderDate = new Date(order.date);
                    return orderDate.toDateString() === today.toDateString();
                });

                const totalSales = todayOrders.reduce((sum, order) => sum + order.total, 0);
                const totalOrders = todayOrders.length;
                const activeOrders = todayOrders.filter(o => o.status === 'preparando').length;
                const avgPrepTime = totalOrders > 0 ? Math.round((this.settings.prepTime * totalOrders) / totalOrders) : 0;

                document.getElementById('total-sales').textContent = `R$ ${totalSales.toFixed(2)}`;
                document.getElementById('total-orders').textContent = totalOrders;
                document.getElementById('avg-prep-time').textContent = `${avgPrepTime}min`;
                document.getElementById('active-orders').textContent = activeOrders;

                this.renderTopProducts();
                this.renderSalesChart();
            }

            renderTopProducts() {
                const container = document.getElementById('top-products');
                container.innerHTML = '';

                // Calculate total sales per product
                const productSales = {};
                this.orders.forEach(order => {
                    order.items.forEach(item => {
                        const product = this.products.find(p => p.id === item.productId);
                        if (product) {
                            productSales[product.id] = (productSales[product.id] || 0) + (item.quantity * product.price);
                        }
                    });
                });

                // Get top 4 products
                const topProducts = this.products
                    .map(product => ({
                        ...product,
                        totalSales: productSales[product.id] || 0
                    }))
                    .sort((a, b) => b.totalSales - a.totalSales)
                    .slice(0, 4);

                if (topProducts.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📦</div><p>Nenhum dado de vendas disponível.</p></div>';
                    return;
                }

                topProducts.forEach(product => {
                    const categoryIcon = {
                        'lanche': '🍔',
                        'bebida': '🥤',
                        'acompanhamento': '🍟',
                        'sobremesa': '🍰'
                    }[product.category] || '📦';

                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <div class="product-image">${categoryIcon}</div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                            <p class="product-description">${product.description.substring(0, 80)}${product.description.length > 80 ? '...' : ''}</p>
                            <div style="margin-top: 0.75rem; font-size: 0.875rem; color: var(--text-secondary);">
                                <span>Vendas: ${product.sales} un.</span> | 
                                <span>Receita: R$ ${(product.totalSales || 0).toFixed(2)}</span>
                            </div>
                            <div class="product-actions">
                                <button class="btn btn-primary btn-small" onclick="app.showProductModal('edit', ${product.id})">
                                    Editar
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }

            renderSalesChart() {
                const ctx = document.getElementById('sales-chart');
                if (!ctx) return;

                // Clear previous chart
                ctx.style.background = '';
                
                // Sample data for the last 7 days
                const now = new Date();
                const labels = [];
                const data = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('pt-BR', { weekday: 'short' }));
                    
                    const dayOrders = this.orders.filter(order => {
                        const orderDate = new Date(order.date);
                        return orderDate.toDateString() === date.toDateString();
                    });
                    
                    data.push(dayOrders.reduce((sum, order) => sum + order.total, 0));
                }

                // Simple bar chart using Canvas
                const canvas = ctx.getContext('2d');
                const width = ctx.canvas.width;
                const height = ctx.canvas.height;
                const padding = 40;
                const barWidth = (width - padding * 2) / labels.length / 1.2;
                const maxValue = Math.max(...data);

                // Clear canvas
                canvas.clearRect(0, 0, width, height);

                // Draw grid
                canvas.strokeStyle = 'rgba(0, 0, 0, 0.1)';
                canvas.lineWidth = 1;
                for (let i = 1; i < 5; i++) {
                    const y = height - padding - (i / 4) * (height - padding * 2);
                    canvas.beginPath();
                    canvas.moveTo(padding, y);
                    canvas.lineTo(width - padding, y);
                    canvas.stroke();
                    
                    // Y-axis labels
                    canvas.fillStyle = 'rgba(0, 0, 0, 0.6)';
                    canvas.font = '12px Inter';
                    canvas.textAlign = 'right';
                    canvas.fillText(`R$ ${(maxValue * i / 4).toLocaleString('pt-BR')}`, padding - 10, y + 4);
                }

                // Draw bars
                data.forEach((value, index) => {
                    const barHeight = (value / maxValue) * (height - padding * 2);
                    const x = padding + index * (barWidth * 1.2) + barWidth * 0.1;
                    const y = height - padding - barHeight;

                    // Bar
                    canvas.fillStyle = 'var(--primary-color)';
                    canvas.fillRect(x, y, barWidth, barHeight);

                    // Value label
                    canvas.fillStyle = 'white';
                    canvas.font = 'bold 11px Inter';
                    canvas.textAlign = 'center';
                    canvas.fillText(`R$ ${value.toFixed(0)}`, x + barWidth / 2, y - 5);

                    // X-axis labels
                    canvas.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    canvas.font = '11px Inter';
                    canvas.textAlign = 'center';
                    canvas.fillText(labels[index], x + barWidth / 2, height - 10);
                });

                // Border
                canvas.strokeStyle = 'rgba(0, 0, 0, 0.2)';
                canvas.strokeRect(padding - 1, padding - 1, width - padding * 2 + 2, height - padding * 2 + 2);
            }

            renderReports() {
                const period = document.getElementById('report-period').value;
                const type = document.getElementById('report-type').value;
                
                this.updateReportContent(period, type);
                this.renderReportsChart();
            }

            updateReportContent(period, type) {
                const reportTitle = document.getElementById('report-title');
                const reportContent = document.getElementById('report-content');
                
                let title = '';
                let content = '';

                const getPeriodOrders = () => {
                    const now = new Date();
                    switch(period) {
                        case 'today':
                            return this.orders.filter(order => {
                                const orderDate = new Date(order.date);
                                return orderDate.toDateString() === now.toDateString();
                            });
                        case 'week':
                            const weekStart = new Date(now);
                            weekStart.setDate(now.getDate() - now.getDay());
                            return this.orders.filter(order => {
                                const orderDate = new Date(order.date);
                                return orderDate >= weekStart;
                            });
                        case 'month':
                            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                            return this.orders.filter(order => {
                                const orderDate = new Date(order.date);
                                return orderDate >= monthStart;
                            });
                        default:
                            return this.orders;
                    }
                };

                const periodOrders = getPeriodOrders();

                switch(type) {
                    case 'sales':
                        title = `Relatório de Vendas - ${period.charAt(0).toUpperCase() + period.slice(1)}`;
                        const totalRevenue = periodOrders.reduce((sum, order) => sum + order.total, 0);
                        const avgOrderValue = periodOrders.length > 0 ? (totalRevenue / periodOrders.length).toFixed(2) : 0;
                        content = `
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value">R$ ${totalRevenue.toFixed(2)}</div>
                                    <div class="stat-label">Receita Total</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${periodOrders.length}</div>
                                    <div class="stat-label">Total de Pedidos</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">R$ ${avgOrderValue}</div>
                                    <div class="stat-label">Ticket Médio</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${((totalRevenue / (periodOrders.length || 1)) * 100).toFixed(0)}%</div>
                                    <div class="stat-label">Conversão</div>
                                </div>
                            </div>
                            <div style="margin-top: 1.5rem;">
                                <h4>Pedidos por Status:</h4>
                                <ul style="list-style: none; padding: 0;">
                                    ${Object.entries(periodOrders.reduce((acc, order) => {
                                        acc[order.status] = (acc[order.status] || 0) + 1;
                                        return acc;
                                    }, {})).map(([status, count]) => `
                                        <li style="padding: 0.5rem; border-bottom: 1px solid var(--border);">
                                            ${status.charAt(0).toUpperCase() + status.slice(1)}: ${count} pedidos
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        `;
                        break;

                    case 'products':
                        title = `Relatório de Produtos - ${period.charAt(0).toUpperCase() + period.slice(1)}`;
                        const productStats = this.products.map(product => {
                            const sales = periodOrders.reduce((sum, order) => {
                                const itemSales = order.items.reduce((itemSum, item) => {
                                    return item.productId === product.id ? itemSum + item.quantity : itemSum;
                                }, 0);
                                return sum + itemSales;
                            }, 0);
                            const revenue = sales * product.price;
                            return { ...product, sales, revenue };
                        }).sort((a, b) => b.revenue - a.revenue);
                        
                        content = `
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Produto</th>
                                            <th>Unidades Vendidas</th>
                                            <th>Receita</th>
                                            <th>Estoque Restante</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${productStats.map(product => `
                                            <tr>
                                                <td>${product.name}</td>
                                                <td>${product.sales}</td>
                                                <td>R$ ${product.revenue.toFixed(2)}</td>
                                                <td>${product.stock}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                        break;

                    case 'orders':
                        title = `Relatório de Pedidos - ${period.charAt(0).toUpperCase() + period.slice(1)}`;
                        content = `
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Cliente</th>
                                            <th>Total</th>
                                            <th>Status</th>
                                            <th>Data/Hora</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${periodOrders.slice(0, 10).map(order => {
                                            const statusClass = {
                                                'preparando': 'status-preparing',
                                                'entregue': 'status-delivered',
                                                'cancelado': 'status-cancelled'
                                            }[order.status];
                                            return `
                                                <tr>
                                                    <td>#${order.id}</td>
                                                    <td>${order.customer}</td>
                                                    <td>R$ ${order.total.toFixed(2)}</td>
                                                    <td><span class="status ${statusClass}">${order.status}</span></td>
                                                    <td>${new Date(order.date).toLocaleString('pt-BR')}</td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                            ${periodOrders.length > 10 ? `<p style="text-align: center; color: var(--text-secondary); margin-top: 1rem;">Mostrando os 10 primeiros de ${periodOrders.length} pedidos...</p>` : ''}
                        `;
                        break;

                    case 'customers':
                        title = `Relatório de Clientes - ${period.charAt(0).toUpperCase() + period.slice(1)}`;
                        const customerStats = periodOrders.reduce((acc, order) => {
                            if (!acc[order.customer]) {
                                acc[order.customer] = { orders: 0, total: 0, phone: order.phone };
                            }
                            acc[order.customer].orders++;
                            acc[order.customer].total += order.total;
                            return acc;
                        }, {});
                        
                        const topCustomers = Object.entries(customerStats)
                            .map(([name, stats]) => ({ name, ...stats }))
                            .sort((a, b) => b.total - a.total)
                            .slice(0, 10);

                        content = `
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Cliente</th>
                                            <th>Pedidos</th>
                                            <th>Total Gasto</th>
                                            <th>Telefone</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${topCustomers.map(customer => `
                                            <tr>
                                                <td>${customer.name}</td>
                                                <td>${customer.orders}</td>
                                                <td>R$ ${customer.total.toFixed(2)}</td>
                                                <td>${customer.phone || 'N/I'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            ${periodOrders.length > 0 ? `<p style="text-align: center; color: var(--text-secondary); margin-top: 1rem;">Total de clientes únicos: ${Object.keys(customerStats).length}</p>` : '<p style="text-align: center; color: var(--text-secondary);">Nenhum cliente registrado no período.</p>'}
                        `;
                        break;
                }

                reportTitle.textContent = title;
                reportContent.innerHTML = content;
            }

            renderReportsChart() {
                const ctx = document.getElementById('reports-chart');
                if (!ctx) return;

                const period = document.getElementById('report-period').value;
                const type = document.getElementById('report-type').value;

                const canvas = ctx.getContext('2d');
                const width = ctx.canvas.width;
                const height = ctx.canvas.height;
                const padding = 40;

                canvas.clearRect(0, 0, width, height);

                // Simple pie chart for reports
                if (type === 'sales') {
                    const statusCounts = this.orders.reduce((acc, order) => {
                        acc[order.status] = (acc[order.status] || 0) + 1;
                        return acc;
                    }, {});

                    const total = Object.values(statusCounts).reduce((sum, count) => sum + count, 0);
                    let startAngle = 0;

                    Object.entries(statusCounts).forEach(([status, count]) => {
                        const sliceAngle = (count / total) * 2 * Math.PI;
                        const endAngle = startAngle + sliceAngle;

                        const statusColors = {
                            'preparando': '#F39C12',
                            'entregue': '#27AE60',
                            'cancelado': '#E74C3C'
                        };

                        canvas.beginPath();
                        canvas.moveTo(width / 2, height / 2);
                        canvas.arc(width / 2, height / 2, Math.min(width, height) / 2 - padding, startAngle, endAngle);
                        canvas.closePath();
                        canvas.fillStyle = statusColors[status] || '#95A5A6';
                        canvas.fill();

                        // Label
                        const labelAngle = startAngle + sliceAngle / 2;
                        const labelX = width / 2 + (Math.min(width, height) / 2 - padding / 2) * Math.cos(labelAngle);
                        const labelY = height / 2 + (Math.min(width, height) / 2 - padding / 2) * Math.sin(labelAngle);

                        canvas.fillStyle = 'white';
                        canvas.font = 'bold 12px Inter';
                        canvas.textAlign = 'center';
                        canvas.fillText(`${status}: ${Math.round((count / total) * 100)}%`, labelX, labelY);

                        startAngle = endAngle;
                    });
                } else {
                    // Default bar chart for other types
                    canvas.fillStyle = 'var(--primary-color)';
                    canvas.fillRect(padding, height - padding - 50, width - padding * 2, 50);
                    
                    canvas.fillStyle = 'white';
                    canvas.font = '16px Inter';
                    canvas.textAlign = 'center';
                    canvas.fillText('Gráfico em desenvolvimento', width / 2, height / 2);
                }
            }

            filterReports() {
                const period = document.getElementById('report-period').value;
                const type = document.getElementById('report-type').value;
                this.updateReportContent(period, type);
                this.renderReportsChart();
            }

            exportReport(format = 'csv') {
                const period = document.getElementById('report-period').value;
                const type = document.getElementById('report-type').value;
                
                let csvContent = '';
                let filename = `relatorio_${type}_${period}_${new Date().toISOString().split('T')[0]}.csv`;
                
                switch(type) {
                    case 'sales':
                        csvContent = 'Tipo de Pedido,Quantidade,Valor Total\n';
                        const statusCounts = this.orders.reduce((acc, order) => {
                            acc[order.status] = (acc[order.status] || { count: 0, total: 0 });
                            acc[order.status].count++;
                            acc[order.status].total += order.total;
                            return acc;
                        }, {});
                        
                        Object.entries(statusCounts).forEach(([status, stats]) => {
                            csvContent += `${status},${stats.count},R$ ${stats.total.toFixed(2)}\n`;
                        });
                        break;
                        
                    case 'products':
                        csvContent = 'Produto,Categoria,Preço,Unidades Vendidas,Receita,Estoque\n';
                        this.products.forEach(product => {
                            const sales = this.orders.reduce((sum, order) => {
                                return sum + order.items.reduce((itemSum, item) => {
                                    return item.productId === product.id ? itemSum + item.quantity : itemSum;
                                }, 0);
                            }, 0);
                            const revenue = sales * product.price;
                            csvContent += `"${product.name}","${product.category}",R$ ${product.price.toFixed(2)},${sales},R$ ${revenue.toFixed(2)},${product.stock}\n`;
                        });
                        break;
                        
                    default:
                        csvContent = 'Relatório em desenvolvimento\n';
                }

                if (format === 'csv') {
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    if (link.download !== undefined) {
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', filename);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                    this.showNotification(`Relatório exportado como ${format.toUpperCase()}!`, 'success');
                }
            }

            printReport() {
                window.print();
                this.showNotification('Relatório enviado para impressão!', 'success');
            }

            // Settings
            saveCompanySettings() {
                this.companies[this.currentCompany].name = document.getElementById('company-name-input').value;
                this.companies[this.currentCompany].cnpj = document.getElementById('company-cnpj').value;
                this.companies[this.currentCompany].phone = document.getElementById('company-phone').value;
                this.companies[this.currentCompany].address = document.getElementById('company-address').value;
                
                this.saveData();
                this.updateCompanyInfo();
                this.showNotification('Configurações da empresa salvas!', 'success');
            }

            saveSystemSettings() {
                this.settings.prepTime = parseInt(document.getElementById('prep-time').value);
                this.settings.deliveryFee = parseFloat(document.getElementById('delivery-fee').value);
                this.settings.autoStatus = document.getElementById('auto-status').value;
                
                this.saveData();
                this.refreshDashboard();
                this.showNotification('Configurações do sistema salvas!', 'success');
            }

            // UI Utilities
            populateNavigation() {
                const navContainer = document.getElementById('nav-content');
                const pages = [
                    { id: 'dashboard', label: 'Dashboard', icon: '📊' },
                    { id: 'products', label: 'Produtos', icon: '🍔' },
                    { id: 'orders', label: 'Pedidos', icon: '📋' },
                    { id: 'reports', label: 'Relatórios', icon: '📈' },
                    { id: 'users', label: 'Usuários', icon: '👥' },
                    { id: 'settings', label: 'Configurações', icon: '⚙️' }
                ];

                navContainer.innerHTML = pages.map(page => 
                    `<a href="#" class="nav-link ${page.id === 'dashboard' ? 'active' : ''}" onclick="selectPage('${page.id}'); return false;">
                        ${page.icon} ${page.label}
                    </a>`
                ).join('');
            }

            populateProductSelects() {
                const selects = document.querySelectorAll('#order-items select, .order-item select');
                selects.forEach(select => {
                    if (!select.hasAttribute('data-populated')) {
                        select.innerHTML = '<option value="">Selecione um produto</option>' +
                            this.products.map(product => 
                                `<option value="${product.id}">${product.name} - R$ ${product.price.toFixed(2)}</option>`
                            ).join('');
                        select.setAttribute('data-populated', 'true');
                    }
                });
            }

            applyTheme() {
                document.documentElement.setAttribute('data-theme', this.theme);
                document.getElementById('theme-icon').textContent = this.theme === 'dark' ? '☀️' : '🌙';
            }

            toggleTheme() {
                this.theme = this.theme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', this.theme);
                this.applyTheme();
                this.showNotification(`Tema alterado para ${this.theme === 'dark' ? 'escuro' : 'claro'}`, 'success');
            }

            showModal(modalId) {
                document.getElementById(modalId).classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
                document.body.style.overflow = '';
                
                // Clear forms
                if (modalId === 'product-modal') {
                    document.getElementById('product-form').reset();
                    document.getElementById('product-id').value = '';
                } else if (modalId === 'order-modal') {
                    document.getElementById('order-form').reset();
                    document.getElementById('order-items').innerHTML = `
                        <div class="order-item">
                            <select class="form-select" onchange="app.updateOrderTotal()">
                                <option value="">Selecione um produto</option>
                            </select>
                            <input type="number" class="form-input" min="1" value="1" onchange="app.updateOrderTotal()" style="width: 80px;">
                            <button type="button" class="btn btn-danger btn-small" onclick="app.removeOrderItem(this)">Remover</button>
                        </div>
                    `;
                    this.populateProductSelects();
                } else if (modalId === 'user-modal') {
                    document.getElementById('user-form').reset();
                    document.getElementById('user-id').value = '';
                }
            }

            showNotification(message, type = 'success') {
                const container = document.getElementById('notification-container');
                const notification = document.createElement('div');
                notification.className = `notification ${type} show`;
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>${type === 'success' ? '✅' : type === 'error' ? '❌' : '⚠️'}</span>
                        <span>${message}</span>
                    </div>
                `;
                
                container.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }

            playNotificationSound() {
                // Simple beep sound using Web Audio API
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    console.log('Notification sound not supported');
                }
            }

            // Data Persistence
            saveData() {
                const data = {
                    currentUser: this.currentUser,
                    currentCompany: this.currentCompany,
                    products: this.products,
                    orders: this.orders,
                    users: this.users,
                    settings: this.settings
                };
                
                localStorage.setItem('lunchcontrol-data', JSON.stringify(data));
                localStorage.setItem('lunchcontrol-user', JSON.stringify(this.currentUser));
            }

            loadData() {
                const savedData = localStorage.getItem('lunchcontrol-data');
                const savedUser = localStorage.getItem('lunchcontrol-user');
                
                if (savedData) {
                    const data = JSON.parse(savedData);
                    this.currentUser = data.currentUser;
                    this.currentCompany = data.currentCompany || 'lanchonete-a';
                    this.products = data.products || [];
                    this.orders = data.orders || [];
                    this.users = data.users || [];
                    this.settings = { ...this.settings, ...data.settings };
                }
                
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                }
            }

            // Page Navigation
            renderAll() {
                this.renderProducts();
                this.renderOrders();
                this.renderUsers();
                this.renderDashboard();
                this.renderReports();
                this.populateProductSelects();
            }

            changeChartPeriod(period) {
                document.getElementById('report-period').value = period;
                this.filterReports();
                this.showNotification(`Gráfico alterado para período: ${period}`, 'success');
            }
        }

        // Global app instance
        const app = new LunchControlApp();

        // Page Navigation
        function selectPage(pageId) {
            // Update sidebar
            document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
            event ? event.target.closest('.sidebar-link').classList.add('active') : 
                   document.querySelector(`[onclick="selectPage('${pageId}')"]`).classList.add('active');
            
            // Update main nav
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[onclick="selectPage('${pageId}')"]`)?.classList.add('active');

            // Show page
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            // Page-specific actions
            if (pageId === 'dashboard') {
                app.renderDashboard();
            } else if (pageId === 'products') {
                app.renderProducts();
            } else if (pageId === 'orders') {
                app.renderOrders();
            } else if (pageId === 'reports') {
                app.filterReports();
            } else if (pageId === 'users') {
                app.renderUsers();
            }

            // Close mobile menu if open
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenu && mobileMenu.classList.contains('active')) {
                mobileMenu.classList.remove('active');
            }
        }

        function toggleUserMenu() {
            // Simple dropdown functionality
            const userMenu = document.querySelector('.user-menu');
            userMenu.classList.toggle('active');
        }

        function closeAllModals() {
            document.querySelectorAll('.modal.active').forEach(modal => {
                modal.classList.remove('active');
            });
            document.body.style.overflow = '';
        }

        // Close modals on outside click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeAllModals();
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAllModals();
            }
        });

        // Prevent body scroll when modal is open
        document.addEventListener('DOMContentLoaded', () => {
            if (document.getElementById('login-modal').classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            }
        });

        // Auto-save every 30 seconds
        setInterval(() => {
            if (app.currentUser) {
                app.saveData();
            }
        }, 30000);

        // Real-time order notifications (demo)
        setInterval(() => {
            if (app.currentUser && Math.random() < 0.1) { // 10% chance every minute
                app.showNotification('Novo pedido recebido! #127', 'warning');
                app.playNotificationSound();
            }
        }, 60000);

        // Initialize charts on load
        document.addEventListener('DOMContentLoaded', () => {
            // Resize canvas on window resize
            window.addEventListener('resize', () => {
                app.renderSalesChart();
                app.renderReportsChart();
            });

            // Set canvas sizes
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            });
        });
    </script>
</body>
</html>